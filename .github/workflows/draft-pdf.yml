name: Paper Draft

on:
  # Manual trigger
  workflow_dispatch:
    inputs:
      ref:
        description: 'Branch or tag to build from'
        required: false
        default: 'main'
        type: string
  
  # Trigger on push to main, but only if paper/figures changed
  push:
    branches:
      - main
    paths:
      - 'menger/paper/**'
      - 'menger/figures/**'
      - '.github/workflows/draft-pdf.yml'
  
  # Trigger on PR, but only if paper/figures changed
  pull_request:
    branches:
      - main
    paths:
      - 'paper/**'
      - 'figures/**'
      - '.github/workflows/draft-pdf.yml'

jobs:
  draft-pdf:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref || github.ref }}
          fetch-depth: 0
      
      - name: Build Draft PDF
        uses: openjournals/openjournals-draft-action@master
        with:
          journal: joss
          paper-path: paper/paper.md
      
      - name: Upload PDF artifact
        uses: actions/upload-artifact@v4
        with:
          name: paper-draft-${{ github.sha }}
          path: paper/paper.pdf